# 渠道分析

> ****ℹ **重要说明**
>
> 渠道分析功能的使用需要相应平台集成支持该功能的SDK：
>
> Android SDK ：v4.1.2 及以上
>
> iOS SDK： v4.1.2 及以上
>
> JS SDK：v4.1.3 及以上
>
> 小程序 SDK：v4.1.3 及以上

渠道，即企业（产品）与用户产生互动的各个触点，比如搜索引擎、社交媒体、广告平台、线下站会等等。

一个完整的用户旅程，通常包括：站外渠道→展示创意→投放 URL →着陆页→辅助转化文案及 CTA →（应用商店（仅移动端）→产品转化流 6大关键环节，每个环节都有相应的指标来衡量渠道入口。

| 用户旅程 | 影响因素 | 度量指标 | 优化点 | 通常负责的团队 |
| :--- | :--- | :--- | :--- | :--- |
| 站外渠道 | 用户匹配度  广告出价 | 展示量  点击量 | 渠道选择  人群优化  智能出价 | 市场/运营 |
| 创意 | 用户匹配度  创意吸引度 | CTR（Click Through Rate，点击率） | 创意优化  A/B测试 | 市场/运营 |
| 链接URL | 是否可以打开 |  |  | 市场/运营 |
| 着陆页 | 着陆页质量 （与创意的符合程度、着陆页本身的内容）  用户匹配度 | 着陆页PV   着陆页UV   加载时长   跳出率 | 着陆页优化 | 市场/运营 |
| 辅助转化的内容及CTA | 辅助转化的内容相关性 CTA（Call To Action，召唤用户行动） | 停留时长   访问深度   …… | 辅助转化内容CTA | 运营/产品 |
| 产品转化 | 产品设计 | 转化用户    转化率   e.g. 下载、注册成功、交易 | 产品本身 | 产品 |

站外渠道的广告展示量、点击量等数据方舟目前无法获得，不在范畴之内。

渠道分析模型用于分析用户（包括访客）的访问来源，通过访问用户数、访问次数、访问时长、跳出率等基础指标评估渠道质量，同时也支持自定义转化目标衡量渠道的转化效果。

## 渠道分析能解决哪些问题？

1. 各个渠道实时的访问用户数、浏览量如何？
2. 上周选择了多个渠道对网站进行了推广，各个渠道带来的用户注册量如何？
3. 社交媒体、搜索引擎、外部链接……哪个渠道带来的用户留存率更高？
4. 微信来源用户更多集中在公众号还是朋友圈？
5. 哪些搜索词带来的流量很大，且转化效果也好？

   ……

## 功能说明

![image](https://imguserradar.analysys.cn/fangzhou/img/2019/01/201901151116397702.jpg)

### 1. 定义指标区

左侧为指标定义区域，选择分析的平台、渠道的维度、基础指标和转化指标，衡量渠道表现

![img](https://imguserradar.analysys.cn/fangzhou/img/2019/01/201901151130096897.jpg)

#### 1.1 选择分析平台

支持Web/H5、APP、小程序平台，细分查看渠道表现，因为各个平台衡量的指标和细分维度会略有差异；

同时支持添加条件，比如查看 Web/H5 平台下某个具体着陆页的访问来源情况；APP 某个版本的用户来源情况。

![img](https://imguserradar.analysys.cn/fangzhou/img/2019/01/201901181139112512.gif)

#### 1.2 选择分析渠道的维度

> 注：渠道分析模型中分析的是用户的每一次访问的来源（即一个Session的来源）。当用户产生一次访问时，会根据上报的URL中的UTM参数、referrer信息来识别不同的渠道属性，具体处理规则详见文末 [《附：渠道来源识别规则》](analytics-channel.md#附：渠道来源识别规则) 。

从下拉框中可以选择不同平台下的渠道分析维度，具体维度如下：

| 属性名称 | 属性说明 | 平台 | 预置属性ID | SDK采集/数据处理说明 |
| :--- | :--- | :--- | :--- | :--- |
| 来源地址 | 页面来源 | Web/H5、小程序 | $referrer | SDK上报 |
| 来源域名 | 页面来源域名，e.g.baidu.com | Web/H5 | $referrer\_domain | SDK上报 |
| 渠道来源分组 | 渠道来源分组，e.g.搜索引擎、社交媒体、直接访问等 | Web/H5 | $traffic\_source\_type | 根据规则处理，方舟提供预置分组 |
| 活动/广告名称 | 活动/广告名称 | Web/H5、小程序、APP | $utm\_campaign | SDK上报，部分数据处理 |
| 活动/广告媒介 | 活动/广告媒介 | Web/H5、小程序、APP | $utm\_medium | SDK上报，部分数据处理 |
| 活动/广告来源 | 活动/广告来源 | Web/H5、小程序、APP | $utm\_source | SDK上报，部分数据处理 |
| 活动/广告内容 | 活动/广告内容 | Web/H5、小程序、APP | $utm\_content | SDK上报，部分数据处理 |
| 活动/广告关键字 | 活动/广告关键字 | Web/H5、小程序、APP | $utm\_term | SDK上报，部分数据处理 |
| 搜索引擎 | 标识搜索引擎来源，e.g.百度 | Web/H5 | $search\_engine | 根据referrer解析 |
| 搜索词 | 标识搜索词，e.g.易观方舟 | Web/H5 | $search\_keyword | 根据referrer解析 |
| 社交媒体 | 标识社交媒体来源，e.g.微博 | Web/H5 | $social\_media | 根据referrer解析 |
| 社交媒体分享来源 | 标识社交媒体分享来源，e.g.微信朋友圈、微信群 | Web/H5 | $social\_share\_from | 根据referrer和url解析 |
| APP下载渠道 | 下载渠道 | APP | $channel | SDK上报 |
| 场景值 | 标识小程序的场景值，e.g顶部搜索框的搜索结果页 | 小程序 | $scene | SDK上报，根据referrer中的参数解析 |
| 场景值类型 | 标识小程序的场景分类 | 小程序 | $scene\_type | 根据规则方舟，方舟提供预置分组 |

#### 1.3 选择衡量渠道的基础指标

| 基础指标 | 指标说明 | 平台 |
| :--- | :--- | :--- |
| 访问用户数（UV） | Unique Visitor， 访问用户的去重数 | Web/H5、小程序 |
| 访问次数 | 指用户访问应用的总次数，即会话（Session）数 | Web/H5、小程序 |
| 浏览量（PV） | 指用户浏览Web/H5页面的总次数，同一个页面访问多次会被重复计 | Web/H5、小程序 |
| 人均访问次数 | 人均访问次数=访问次数/访问用户数（UV） | Web/H5、小程序 |
| 人均页面浏览量 | 人均页面浏览量=浏览量（PV）/访问用户数（UV） | Web/H5、小程序 |
| 人均访问时长 | 人均访问时长=Session时长之和/访问用户数（UV） | Web/H5、小程序 |
| 单次访问页面浏览量 | 平均每次访问浏览页面的次数，单次访问页面浏览量=浏览量（PV）/访问次数 | Web/H5、小程序 |
| 单次访问时长 | 平均每次访问的时长，单次访问时长=总访问时长/会话数 | Web/H5、小程序 |
| 单次访问事件数 | 平均每次访问的事件数量（包括浏览页面和点击事件），单次访问事件数=总访问事件数/会话数 | Web/H5、小程序 |
| 跳出率 | 跳出率=访问了一个页面的Session数/总的Session数。用户进入着陆页就离开用户来到网站后，除了浏览LandingPage之外，没有发生其他任何操作就离开了网站，被视为跳出。用来衡量Landingpage的质量。 | Web/H5、小程序 |
| 次日留存率 | 某日访问的用户在第2日再次来访问的用户数 | Web/H5、小程序、APP |
| 7日留存率 | 某日访问的用户在第7日再次来访问的用户数 | Web/H5、小程序、APP |
| 14日留存率 | 某日访问的用户在第14日再次来访问的用户数 | Web/H5、小程序、APP |
| 30日留存率 | 某日访问的用户在第30日再次来访问的用户数 | Web/H5、小程序、APP |
| 活跃用户数 | Unique Visitor， 访问用户的去重数 | Web/H5、小程序、APP |
| 访问次数 | 指用户访问应用的总次数，即会话（Session）数 | Web/H5、小程序、APP |
| 人均访问时长 | 人均访问时长=Session时长之和/访问用户数（UV） | Web/H5、小程序、APP |

#### 1.4 选择渠道的转化目标

每一次活动的转化目标可能会不同，方舟支持自定义选择一个事件作为转化目标，来更有效的衡量不同渠道最终的转化质量。

| 转化指标 | 指标说明 | e.g. 转化目标：点击购买 ；访问来源：谷歌搜索 |
| :--- | :--- | :--- |
| x事件的转化用户数 | 指某个渠道进来的用户触发了x事件的用户数 | 从谷歌搜索进入网站之后点击购买的用户数 |
| x事件的转化用户数占比 | x事件的转化用户数/总访问用户数 | 从谷歌搜索进入网站之后点击购买的用户数/进入网站访问的总用户数 |
| x事件的转化次数 | 指某个渠道进来的用户触发了x事件的会话次数 | 从谷歌搜索进入网站之后发生了点击购买的访问次数 |
| x事件的转化次数占比 | x事件的转化次数/总访问次数 | 从谷歌搜索进入网站之后发生了点击购买的访问次数/进入网站的总次数 |
| x事件的y属性z指标 | x事件的y属性z指标（不同数据类型的属性值有不同的指标） | 从谷歌搜索进入网站之后点击购买的购买金额的总和 |

### 2. 选择对比分群区

支持选择某个细分分群，查看他们从各个不同渠道访问进入产品中的情况；也支持多个分群对比，比如对比所有用户的访问来源和新访用户的访问来源

![img](https://imguserradar.analysys.cn/fangzhou/img/2019/01/201901161415194560.jpg)

### 3. 图表展示区

图表展示区，可以选择时间范围，时间粒度，图表样式

#### 3.1 时间范围

渠道分析记录的是用户每一次访问的来源，同一个用户每次访问都可能会从不同的来源进入产品当中，比如小鸣昨天从搜索引擎中打开方舟进入查看，今天直接从收藏夹中打开，所以在分析时一定需要框定时间范围。

![image](https://imguserradar.analysys.cn/fangzhou/img/2019/01/201901181158020391.png)

可以选择近30日、今日、上周等常用范围，也可以在右侧自定义开始时间和结束时间。

当选择的是相对时间保存图表后，以后查询时会展示动态的时间范围。

例如今天是3月16日，选择查询近7日，查询结果是3月9日至3月15日的数据；在3月21日打开保存的该图表时，查看到的数据将是3月14日至3月20日。

当选择对比日期时，可以对比上一时段、去年同期、自定义对比指标表现

> **对比上一时段**：从选择时间范围向后移动相同天数的时间范围，比如当前选择的是1月9日-1月15日，选择了对比上一时间，则对比的是1月2日-1月8日，即可以分别对比1月9日与1月2日，1月10日与1月3日……的指标差异   
>  **对比去年同期**：对比当前时间段与去年同期的时间段，比如当前选择的是2019年1月9日-1月15日，选择了对比上一时间，则对比的是2018年1月9日-1月15日，即可以分别对比2019年1月9日与2018年1月9日，2019年1月10日与2018年1月10日……的指标差异  
>  **自定义对比**：自定义时间范围，比如当前选择的是1月9日-1月15日，自定义对比1月8日-1月14日，即可分别对比1月9日与1月8日，1月10日与1月9日……的指标差异

#### 2.2 分析方法

**A. 合计**

合计，表示可以查看一段时间里整体的来源分布。

**B. 趋势**

趋势，可以按照一定的时间粒度聚合，比如查看一段时间里每一天的用户来源分布，也可以查看每周的指标表现。

| 时间粒度 | 说明 |
| :--- | :--- |
| 按合计 | 可以查看选定时间范围内的汇总 |
| 按分钟 | 按分钟聚合，实时计算 |
| 按小时 | 按小时聚合，实时计算 |
| 按日 | 默认按照从 00:00:00 到 23:59:59 的完整日聚合，当时间范围中包含今日时，最多延迟几分钟 |
| 按周 | 默认周一到周日的自然周聚合，当时间范围不足自然周时，计算的是选择范围内所在周若干天的聚合 |
| 按月 | 当时间范围不足自然月时，计算的是选择范围内所在月若干天的聚合 |

#### 2.3 图表结果

展示不同的指标、条件、人群、维度、时间范围、分析方法组合查询结果，支持折线图、柱状图、条形图、面积图、散点图和表格，不同场景下会推荐合适的图形。

| 指标（M） | 维度（D） | 分群（S） | 场景 | 分析方法 | 时间粒度 | 时间对比 | 支持的图表 | 默认显示 | 时间对比时默认显示 |
| :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- | :--- |
| 1 | 1 | 1 | 1M1D1S | 趋势 | 分钟/小时/日/周/月 | √ | 折线图、柱状图、面积图、表格 | 折线图 | 表格 |
| n | 1 | 1 | nM1D1S | 趋势 | 分钟/小时/日/周/月 |  | 表格 | 表格 |  |
| 1 | n | 1 | 1MnD1S | 趋势 | 分钟/小时/日/周/月 | √ | 折线图、柱状图、面积图、表格 | 表格 | 表格 |
| n | n | 1 | nMnD1S | 趋势 | 分钟/小时/日/周/月 |  | 表格 | 表格 |  |
| 1 | 1 | n | 1M1DnS | 趋势 | 分钟/小时/日/周/月 |  | 折线图、柱状图、面积图、表格 | 柱形图 |  |
| n | 1 | n | nM1DnS | 趋势 | 分钟/小时/日/周/月 |  |  |  |  |
| 1 | n | n | 1MnDnS | 趋势 | 分钟/小时/日/周/月 |  | 表格 | 表格 |  |
| n | n | n | nMnDnS | 趋势 | 分钟/小时/日/周/月 |  |  |  |  |
| 1 | 1 | 1 | 1M1D1S | 合计 |  | √ | 环状图、柱状图、条形图、表格 | 环状图 | 表格 |
| n | 1 | 1 | nM1D1S | 合计 |  | √ | 环状图、柱状图、条形图、散点图、表格 | 散点图 | 表格 |
| 1 | n | 1 | 1MnD1S | 合计 |  | √ | 环状图、柱状图、条形图、表格 | 表格 | 表格 |
| n | n | 1 | nMnD1S | 合计 |  | √ | 环状图、柱状图、条形图、散点图、表格 | 表格 | 表格 |
| 1 | 1 | n | 1M1DnS | 合计 |  | √ | 环状图、柱状图、条形图、表格 | 环状图 | 表格 |
| n | 1 | n | nM1DnS | 合计 |  | √ | 表格 | 表格 | 表格 |
| 1 | n | n | 1MnDnS | 合计 |  | √ | 环状图、柱状图、条形图、表格 | 表格 | 表格 |
| n | n | n | nMnDnS | 合计 |  | √ | 表格 | 表格 | 表格 |

以下将结合具体场景举例说明：

**A. 分析各类渠道上获取的新用户访问趋势**

选择【新访问用户】分群，选择【渠道来源分组】维度，选择【访问用户数】指标，分析方法【趋势】，时间粒度【按日】

![image](https://imguserradar.analysys.cn/fangzhou/img/2019/01/201901161517453802.jpg)

**B. 分析各类渠道上新增老用户的差异**

选择【新访问用户】、【所有用户】分群，选择【渠道来源分组】维度，选择【访问用户数】指标，分析方法【合计】

![image](https://imguserradar.analysys.cn/fangzhou/img/2019/01/201901161527544607.jpg)

**C. 分析不同搜索引擎来源的用户访问质量**

选择【新访问用户】分群，选择【搜索引擎】维度，选择【访问用户数】、【跳出率】指标，分析方法【合计】，选择散点图，可以查看质量矩阵，快速识别访问用户数高，跳出率又低的高质量渠道

![image](https://imguserradar.analysys.cn/fangzhou/img/2019/01/201901161557407210.jpg)

**D. 分析不同着陆页的指标表现**

选择【新访问用户】分群，选择【着陆页】维度，选择【访问用户数】、【跳出率】等指标，通过表格可以直观查看各个着陆页的各个指标标表现

![image](https://imguserradar.analysys.cn/fangzhou/img/2019/01/201901161611444294.jpg)

### 4. 其他功能

其他保存、下载共享、抽样计算、强制刷新等等所有分析模型通用功能，详见[《分析》](./)。

## 附：渠道来源识别规则

### 附1 渠道相关名词解释

**渠道识别**

移动端和 Web 端略有差异

* Web 端/小程序：国内外都是通过URL的 Referer 和 LinkTag（e.g. UTM 参数） 识别；
* 移动端：国外通过 Google Play 和 AppStore 的参数传递来实现；国内应用商店百花齐放，情况比较复杂，通过渠道包、OneLink、DeepLink 等多种方式实现

**Referer**

HTTP Referer是header的一部分，当浏览器向web服务器发送请求的时候，一般会带上Referer，告诉服务器我是从哪个页面链接过来的，是一个页面的物理来源，部分情况下出于安全/隐私考虑会被隐藏。

通过对这个值的解析，可以知道来源 domain 甚至具体页面，还可以将 domain 进行可读性转义。

**Link Tag**

广告链接标记，通过类似 UTM 的参数来标记，在标记的目标页面 URL 中携带，可以人为配置，具体使用方法详见[《广告跟踪》](../operation/operation-utm.md)。

**会话（Session）**

Session 是一系列用户行为的集合。来源标识的也是一个 Session 的来源。

怎样一些列行为算是一个Session？详见 [《附6 Session 规则》](analytics-channel.md#附6-session-规则)

**着陆页（LandingPage）**

用户进入目标网站的第一个页面。用户访问的一般过程：站内着陆页A → 后续受访页面B→ 后续受访页面……→ 站内出口页X

**跳出**

用户来到网站后，除了浏览LandingPage之外，没有发生其他任何操作就离开了网站，被视为跳出。

### 附2 来源识别规则

易观方舟会根据一次访问中着陆页的来源来判断当次访问的来源，且本次访问（Session）中所有的事件都会继承这次访问的来源。

数据上报后会根据日志当中 url 中的UTM 参数 、 $referrer （$referrer\_domain）、$channel、消息相关事件中的utm参数等按照一定规则来处理，给每条日志添加UTM参数来源

同时根据如下规则和优先级会对渠道来源进行分组

| 渠道来源类型 | 预定义的识别规则 |
| :--- | :--- |
| 消息通知 | $utm\_campaign\_id 不为空  $utm\_medium = push\_notification |
| 电子邮件 | $utm\_campaign\_id 不为空  $utm\_medium = email |
| 系统预定义的XXX | $utm\_campaign\_id 不为空  $utm\_medium = xxx |
| 指定广告跟踪 | $utm\_source 不为空  $utm\_campaign 不为空  $utm\_medium ≠ push\_notification,email,xxx |
| 搜索引擎 | $utm\_campaign 为空  $utm\_medium = search |
| 社交媒体 | $utm\_campaign 为空  $utm\_medium = social |
| 外部链接 | $utm\_campaign 为空  $utm\_medium = referral |
| 直接访问 | $utm\_campaign 为空  $utm\_medium = direct |

详细识别规则如下： ![image](https://imguserradar.analysys.cn/fangzhou/img/2019/01/201901161628259892.jpg)

> 示例说明： 1. 小鸣打开了google，通过 Q 这个搜索词，找到了您的网站，那我们会根据点击网站时上报日志中的reffererdomain识别出来是谷歌，谷歌的域名被识别为搜索引擎，那么本次访问的所有事件都会加上 utm\_medium = search 的来源，归为搜索引擎的来源类型，并进一步解析搜索词 2. 小鱼通过知乎中的链接进入到您的网站，我们会根据访问记录中的reffererdomain识别出它是知乎，知乎属于社交媒体，那么本次访问会标记为来源知乎，渠道来源类型属于社交媒体 3. 小芳收到了一封您的网站通过方舟发送的邮件，她点击了邮件中的立即查看按钮进入到网站中，那我们会根据点击网站时上报的url识别出来其中utm参数，判断为电子邮件 4. 小平在公众号上扫描了您创建的带UTM参数的二维码，进入网站时，我们会根据url中的参数解析为相应的来源，归为指定广告跟踪 ……

**另外，易观方舟同时兼容了百度统计的参数解析，即如果您自主投放时使用了hm参数，也是可以成功解析**

对应关系如下：

| 百度统计hm参数 | 参数名称 | 说明 | 对应参数名 |
| :--- | :--- | :--- | :--- |
| hmsr | 媒介平台 | 广告所投放的平台，如：新浪、搜狐等 | $utm\_source |
| hmpl | 计划名称 | 广告所属的推广计划，如：元旦促销 | $utm\_medium |
| hmcu | 单元名称 | 广告所属的推广单元，如：七夕促销 | $utm\_campaign |
| hmkw | 关键词 | 该条广告对应的关键词 | $utm\_term |
| hmci | 创意 | 广告内容的简要描述信息 | $utm\_content |

### 附3 搜索引擎

| 域名 | 搜索引擎 | 关键字参数 |
| :--- | :--- | :--- |
| www.baidu.com | 百度 | wd |
| tw.baidu.com | 百度 | wd |
| m.baidu.com | 手机百度 | word |
| google.cn | 谷歌 | q |
| m.google.cn | 谷歌 | q |
| google.com.hk | 谷歌 | q |
| google.com.tw | 谷歌 | q |
| www.google.com.sg | 谷歌 | q |
| google.com | 谷歌 | q |
| sogou.com | 搜狗 | query |
| m.sougou.com | 搜狗 | keyword |
| so.com | 360搜索 | q |
| m.so.com | 360搜索 | q |
| bing.com | 必应 | q |
| sm.cn | 神马搜索 | q |
| so.m.sm.cn | 神马搜索 | q |
| chinaso.com | 中国搜索 | q |
| zhongsou.com | 中搜 | w |
| search.yahoo.com | 雅虎搜索 | p |
| sg.search.yahoo.com | 雅虎搜索 | p |
| easou.com | 宜搜 | q |
| youdao.com | 有道 | q |
| yicha.cn | 易查搜索 | key |
| naver.com | NAVER | query |
| yandex.com | Yandex | text |
| yandex.ru | Yandex | text |

### 附4 社交媒体

| 域名 | 社交媒体 |
| :--- | :--- |
| t.cn | 微博 |
| weibo.com | 微博 |
| weibo.cn | 微博 |
| desktop.weibo.com | 微博 |
| qzone.qq.com | QQ空间 |
| im.qq.com | QQ |
| qun.qq.com | QQ群 |
| wx.qq.com | 微信 |
| wechat.com | 微信 |
| weixin.qq.com | 微信 |
| mp.weixin.qq.com | 微信 |
| mp.weixinbridge.com | 微信 |
| linkedin.com | 领英 |
| maimai.cn | 脉脉 |
| zhihu.com | 知乎 |
| douban.com | 豆瓣 |
| lofter.com | Lofter |
| facebook.com | Facebook |
| twitter.com | Twitter |
| myspace.com | MySpace |
| instagram.com | Instagram |
| t.qq.com | 腾讯微博 |
| t.sohu.com | 搜狐微博 |
| renren.com | 人人网 |
| share.renren.com | 人人网 |
| page.renren.com | 人人网 |
| life.renren.com | 人人网 |
| xiaozu.renren.com | 人人网 |
| kaixin001.com | 开心网 |
| love.163.com | 花田 |
| immomo.com | 陌陌 |
| tantanapp.com | 探探 |
| zhenai.com | 珍爱网 |
| jiayuan.com | 世纪佳缘 |
| baihe.com | 百合网 |

**鉴于微信在目前的流量获取中占据了非常重要的位置，所以我们根据微信环境中打开的数据参数进行了进一步识别**

| 分享来源 | 场景 | 说明 | 参数 |
| :--- | :--- | :--- | :--- |
| 微信-公众号 | 公众号中查看图文消息-点击“阅读原文” | refferer中识别是微信公众号环境，mp.weixin.qq.com |  |
| 微信-朋友圈 | 朋友圈里查看分享的页面类链接 | refferer中识别是微信环境，再根据url中参加上参数识别 | from=timeline |
| 微信-群聊 | 查看分享给群组的页面链接 | refferer中识别是微信环境，再根据url中参加上参数识别 | from=groupmessage |
| 微信-单聊 | 查看分享给单个好友的页面链接 | refferer中识别是微信环境，再根据url中参加上参数识别 | from=singlemessage |
| 微信-其他 | 公众号中直接的文字/图片链接、朋友圈/群聊/单聊消息中的URL链接、扫描在微信中的二维码 | 如果没有自定义加参数的话，只能识别到是微信中打开，但无法识别更具体的来源 |  |

### 附5 场景值类型

小程序官方设置了几十个场景值，便于分析，易观方舟对此也进行了归类

| 序号 | 场景类型 |
| :--- | :--- |
| 1 | 快捷入口 |
| 2 | 搜索 |
| 3 | 广告投放 |
| 4 | 公众号 |
| 5 | 分享 |
| 6 | 二维码 |
| 7 | 小程序间的跳转 |
| 8 | 模板消息 |
| 9 | 卡券 |
| 10 | 测试 |
| 11 | 其它 |

场景值及对应关系如下：

| 场景类型 | 场景值ID | 说明 |
| :--- | :--- | :--- |
| 小程序间的跳转 | 1037 | 小程序打开小程序 |
| 小程序间的跳转 | 1038 | 从另一个小程序返回 |
| 搜索 | 1005 | 顶部搜索框的搜索结果页 |
| 搜索 | 1006 | 发现栏小程序主入口搜索框的搜索结果页 |
| 搜索 | 1027 | 顶部搜索框搜索结果页「使用过的小程序」列表 |
| 搜索 | 1042 | 添加好友搜索框的搜索结果页 |
| 搜索 | 1053 | 搜一搜的结果页 |
| 搜索 | 1106 | 聊天主界面下拉，从顶部搜索框的搜索结果页打开小程序 |
| 其它 | 1019 | 微信钱包 |
| 其它 | 1026 | 附近小程序列表 |
| 其它 | 1039 | 摇电视 |
| 其它 | 1056 | 音乐播放器菜单 |
| 其它 | 1064 | 微信连Wi-Fi状态栏 |
| 其它 | 1069 | 移动应用 |
| 其它 | 1077 | 摇周边 |
| 其它 | 1078 | 连Wi-Fi成功页 |
| 其它 | 1079 | 微信游戏中心 |
| 其它 | 1092 | 城市服务入口 |
| 其它 | 1099 | 页面内嵌插件 |
| 其它 | 1000 | 未知场景 |
| 模板消息 | 1014 | 小程序模板消息 |
| 模板消息 | 1034 | 微信支付完成页 |
| 模板消息 | 1073 | 客服消息列表下发的小程序消息卡片 |
| 模板消息 | 1081 | 客服消息下发的文字链 |
| 快捷入口 | 1001 | 发现栏小程序主入口，「最近使用」列表 |
| 快捷入口 | 1022 | 聊天顶部置顶小程序入口 |
| 快捷入口 | 1023 | 安卓系统桌面图标 |
| 快捷入口 | 1024 | 小程序 profile 页 |
| 快捷入口 | 1054 | 顶部搜索框小程序快捷入口 |
| 快捷入口 | 1089 | 微信聊天主界面下拉，「最近使用」栏 |
| 快捷入口 | 1090 | 长按小程序右上角菜单唤出最近使用历史 |
| 快捷入口 | 1103 | 发现栏小程序主入口，「我的小程序」列表 |
| 快捷入口 | 1104 | 微信聊天主界面下拉，「我的小程序」栏 |
| 卡券 | 1028 | 我的卡包 |
| 卡券 | 1029 | 卡券详情页 |
| 卡券 | 1052 | 卡券的适用门店列表 |
| 卡券 | 1057 | 钱包中的银行卡详情页 |
| 卡券 | 1071 | 钱包中的银行卡列表页 |
| 卡券 | 1072 | 二维码收款页面 |
| 卡券 | 1097 | 微信支付签约页 |
| 广告投放 | 1045 | 朋友圈广告 |
| 广告投放 | 1046 | 朋友圈广告详情页 |
| 广告投放 | 1067 | 公众号文章广告 |
| 广告投放 | 1068 | 附近小程序列表广告 |
| 广告投放 | 1084 | 朋友圈广告原生页 |
| 广告投放 | 1095 | 小程序广告组件 |
| 公众号 | 1020 | 公众号 profile 页相关小程序列表 |
| 公众号 | 1035 | 公众号自定义菜单 |
| 公众号 | 1043 | 公众号模板消息 |
| 公众号 | 1058 | 公众号文章 |
| 公众号 | 1074 | 公众号会话下发的小程序消息卡片 |
| 公众号 | 1082 | 公众号会话下发的文字链 |
| 公众号 | 1091 | 公众号文章商品卡片 |
| 公众号 | 1102 | 公众号 profile 页服务预览 |
| 分享 | 1007 | 单人聊天会话中的小程序消息卡片 |
| 分享 | 1008 | 群聊会话中的小程序消息卡片 |
| 分享 | 1036 | App 分享消息卡片 |
| 分享 | 1044 | 带 shareTicket 的小程序消息卡片 详情 |
| 分享 | 1096 | 聊天记录 |
| 二维码 | 1011 | 扫描二维码 |
| 二维码 | 1012 | 长按图片识别二维码 |
| 二维码 | 1013 | 手机相册选取二维码 |
| 二维码 | 1025 | 扫描一维码 |
| 二维码 | 1031 | 长按图片识别一维码 |
| 二维码 | 1032 | 手机相册选取一维码 |
| 二维码 | 1047 | 扫描小程序码 |
| 二维码 | 1048 | 长按图片识别小程序码 |
| 二维码 | 1049 | 手机相册选取小程序码 |
| 测试 | 1017 | 前往体验版的入口页 |
| 测试 | 1030 | 自动化测试下打开小程序 |
| 测试 | 1059 | 体验版小程序绑定邀请页 |

### 附6 Session 规则

> 怎样的一系列行为算是一个Session？ 通常如下
>
> * iOS应用：用户屏熄、home键到切换后台、杀掉进程、跨天等视为会话结束；
> * Android应用：用户杀掉进、屏熄、按home键超过30秒、跨天等视为会话结束。
> * H5/Web应用：用户从打开网页到离开视为一次会话，包括关闭整个浏览器、30分钟未进行新打开页面、触发事件等活动。如果一次访问跨天的话，会被切割成两次会话

**易观方舟根据用户实际访问的场景，抽象成以下四种规则，来判断一次访问**

| 切割规则 | 优先级 |
| :--- | :--- |
| 跨天 | 1 |
| 强制切割-帐号切换（暂未上线） | 2 |
| 强制切割-广告来源切换 | 3 |
| 新进程 | 4 |
| 可见页面间隔时间 | 5 |

**实际用户的使用场景**

| 场景 | 规则覆盖 |
| :--- | :--- |
| 直接打开A | 新进程 |
| B中的deeplink→A | 强制切割-广告来源切换 |
| 在A中→调起支付/分享→A | 可见页面间隔时间 |
| 在A→接电话→回到A | 可见页面间隔时间 |
| 在A→B中的deeplink→A | 强制切割-广告来源切换 |
| 在APC端→A移动端（跨屏） | 跨屏本身换Session |
| 帐号x使用A后退出登录，切换到帐号y | 强制切割-帐号切换 |
| 打开A一直亮着不操作 | 可见页面间隔时间 |
| 打开A一直在一个页面操作很长时间 | 可见页面间隔时间 |
| 通过消息通知打开A | 强制切割-广告来源切换 |
| 点击home键 | 可见页面间隔时间 |
| 点击两次返回 | 可见页面间隔时间 |
| 锁屏 | 可见页面间隔时间 |
| 熄屏 | 可见页面间隔时间 |
| 主动杀掉进程 | 新进程 |
| 从今天玩到明天 | 跨天 |

## 常见问题

### 1. 为什么按照某个渠道维度细分，各维度值的访问用户数加和不等于总用户数？

渠道分析模型分析的是用户每次的访问来源，在一段时间里同一个用户可能会从多个来源访问进入，那会在多个渠道上分别记录该用户。比如，小鸣上午从谷歌搜索进入方舟，下午从知乎的文章进入方舟网站，那么在查看谷歌来源的时候小鸣会被记入，在查看知乎来源的时候小鸣也会被记录，按照各维度值加总的时候就是会不等于总数，但按访问次数去查看时，各维度值访问次数之和=总访问次数。

### 2. 为什么我的项目查看渠道分析时都没有数据？

渠道分析需要使用 v4.1.3.1\_20181228 之后的SDK上报数据，所以建议更新到最新的SDK，尤其是私有化的项目。

### 3. 什么样的情况会被记录为直接访问？

一般来说，以下情况会被判定为直接访问：

* 通过在 Flash、邮件客户端、MS Office、PDF文档、APP中直接点击链接（未加任何标记）跳转来的访问；
* 在地址栏中直接输入 URL 打开的访问
* 从收藏夹或书签中打开的访问；
* 302 的重定向有时候会导致 referral 被删除
* http 重定向成 https 时，referral 不会传递，主要是因为安全因素
* 其他 refferal 为空的情况

