# 数据模型

用户行为其实就是何人，何时，何地，通过何种方式，发生了何种行为。易观通过**事件模型**来描述用户的一系列行为。事件模型包含了 **事件（Event）**和 **用户（Profile）**两个实体，数据上报时，也会通过 Event 和 Profile 两大类事件接口来上报。

事件 \(Event\) 接口上报事件信息，用以记录用户在何时通过何种方式发生了何种行为；

用户 \(Profile\) 接口上报用户信息，用以记录用户属性相关的信息，来描述用户，进一步进行画像等。

## 1. 事件 \(Event\)

Event 核心是何人 \(xwho\) 、何时 \(xwhen\) 、何地 \(xwhere\) 、通过何种方式 \(xcontext\) 、发生了何种行为 \(xwhat\) 五要素，比如 xiaozhou 在2018-01-31 07:02:48 通过Chrome 浏览器打开了易观方舟网站，这就会触发一个事件，上报如下格式的数据：

```javascript
[
　　{
　　　　"appid":"analysys_ark",
　　　　"xwho":"xiaozhou",
　　　　"xwhat":"PageView",
　　　　"xwhen":1517353368887,
　　　　"xcontext":{
　　　　　　"$ip":"36.104.53.121",
　　　　　　"$url":"https://ark.analysys.cn",
　　　　　　"title":"易观方舟 - 基于业务场景多维度分析用户行为数据",
　　　　　　"user_agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) Chrome/62 "
　　　　}
　　}
]
```

**xwho**

xwho 描述事件发生的实体，即何人。在用户未登录的情况下，xwho 会是一个匿名的 ID，在已登录的情况下的，xwho 就是已注册过的用户，在方舟系统中，xwho 会对应生成一个后端用户标识 distinct\_id, 计算用户数时，都会以 distinct\_id 为基准。实际可能会存在，匿名和实名切换，或者是同一个用户在登录后发生了一系列行为后退出匿名使用，或者是更换了设备再登录后使用等多种情况，行为的贯穿是一个比较复杂的过程，不同情况下 xwho 、distinct\_id 会有不同的对应关系，详细可以查看[《如何准确识别用户》](user-identify.md)。

**xwhen**

xwhen 描述事件发生的时间，即何时。记录的是事件发生的实际时间戳，客户端的时间，精确到毫秒。

**xwhere**

where 描述事件发生的地点，即何地。方舟会默认采集 IP，后端数据处理引擎会自动根据 IP 解析为国家、省份、城市三个字段；当然，如果不想通过这种方式获得地理位置，也可以在集成 SDK 时手动设置 `$country`、`$province`、`$city`的值，当手动设置后，将会覆盖根据 IP 自动解析的值。

当然除了国家、省份、城市这种最基础的地理位置标识方法之外，用户可以自定义更多地理位置的属性，比如城市等级、商圈等。

**xwhat**

xwhat 描述事件本身，即发生了何事，可以是打开 APP、 点击某个按钮、打开某个页面等在APP/Web等应用上的任何操作，也可以是线下某次刷卡、电话投诉等等，每个动作在都可以定义为一个事件， 通过埋点的方式上报，在方舟的数据接口中，使用 xwhat 来存储事件。

当然，为了更精准的描述用户发生的行为，会引入事件属性，例如：

对于 “用户注册” 事件，可能通过属性：注册来源、注册用户名等来描述；

对于“ 搜索” 事件，可能通过属性：搜索关键词、搜索位置等来描述；

对于 “提交订单” 事件，可能通过属性：商品名称、商品金额、配送方式、优惠方式等来描述。

在方舟的数据接口中，使用 xcontext 来存储事件属性。

**xcontext**

xcontext 描述事件的属性，即以何种方式发生。xcontext 是一个比较广泛的概念，除了包括 xwhat 中提到的事件本身的属性之外，还会包括用户使用的设备信息（设备品牌、型号等）、使用时的网络状态、使用的应用版本、来源渠道等等，在事件发生时，一起作为上下文信息上报。

方舟系统预置了一些属性在每个事件中上报，使常用的分析维度无须再手动上报，详见[《预置事件和属性》](default-data.md)。

## 2. 用户 \(profile\)

用户是发生事件的实体，通过 distinct\_id、xwho 来标识用户，并与其事件关联。方舟支持通过一系列的 profile 接口来上报更新用户属性，即 profile 信息。

通常是在用户注册、完善个人信息、修改资料等的情况下，调用相应的 profile 接口来上报。比如一个用户在注册应用后，更新了个人资料，触发上报如下信息，就能知道这个用户叫小舟，性别男，1998 年出生，目前在易观，工作邮箱是 fangzhou@analysys.com.cn

数据格式如下：

```javascript
[
　　{
　　　　"appid":"analysys_ark",
　　　　"xwhat":"$profile_set",
　　　　"xwhen":1517353368887,
　　　　"xwho":"21917482d8338983d07d10523f1e2ae38672269",
　　　　"xcontext":{
　　　　　　"sex":"female",
　　　　　　"birthday":1998,
　　　　　　"email":"fangzhou@analysys.com.cn",
　　　　　　"name":"xiaozhou",
　　　　    "company":"analysys",
　　　　　　"$time_zone":"GMT+08:00"
　　　　}
　　}
]
```

事件模型能够从更多维度描述用户和用户发生的行为，在分析过程中，也能够进行多维度的交叉分析，为精细化分析和运营提供更多途径。

